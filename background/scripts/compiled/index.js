'use strict';/**
 * Created by 31641 on 2017-6-4.
 */var _ref=[$('#register_username'),$('#register_email'),$('#register_password'),$('#register_password_again'),$('#verification_code')],$register_username=_ref[0],$register_email=_ref[1],$register_password=_ref[2],$register_password_again=_ref[3],$verification_code=_ref[4];var _ref2=[$('#login_email'),$('#login_password')],$login_email=_ref2[0],$login_password=_ref2[1];//const $remember_me_checkbox = $('#remember_me_checkbox');
/**IE detection**/$(function(){var parser=new UAParser();var $ie9_warning=$('#ie9_warning');if(parser.getBrowser().name==='IE'){if(parseInt(parser.getBrowser().version)===9){$ie9_warning.fadeIn(500);}else if(parseInt(parser.getBrowser().version)<9){window.location='ie_refuse.html';}}});/**Input tips**/$(function(){tip_by_id('register_username','请输入你的用户名。16个字符以内');tip_by_id('register_email','请输入你的邮箱。邮箱将用于接收验证码以及登录');tip_by_id('register_password','请输入你的密码。32个字符以内，允许字母、数字、下划线');tip_by_id('register_password_again','请再次输入你的密码');tip_by_id('verification_code','请输入接收到的验证码');tip_by_id('forget_username','请输入最后使用的用户名');tip_by_id('forget_email','请输入注册时使用的邮箱');tip_by_id('login_email','请输入邮箱');tip_by_id('login_password','请输入密码');});/**get verification code**/$(function(){var $verification_code_btn=$('#verification_code_btn');$verification_code_btn.click(function(event){event.preventDefault();var status=true;if(!USERNAME_REG.test($register_username.val())){$register_username.css('borderColor','red');status=false;}if(!EMAIL_REG.test($register_email.val())){$register_email.css('borderColor','red');status=false;}if(!PASSWORD_REG.test($register_password.val())){$register_password.css('borderColor','red');status=false;}else if($register_password.val()!==$register_password_again.val()){$register_password_again.css('borderColor','red');status=false;}if(status===false){modal_append_warning('register_modal_body','danger','glyphicon-remove','填写信息有误');return false;}$verification_code_btn.attr('disabled','disabled');var WAIT_TIME=60;//(Seconds) Time before user can get another code;
var sec=WAIT_TIME;var interval=setInterval(function(){sec--;$verification_code_btn.text(sec+'\u79D2\u540E\u518D\u83B7\u53D6');},1000);var timeout=setTimeout(function(){clearInterval(interval);$verification_code_btn.removeAttr('disabled');$verification_code_btn.text('获取验证码');sec=WAIT_TIME;},WAIT_TIME*1000);var data={};data.email=$register_email.val();AJAX('signup',data,function(response){if(response.status.code===0){modal_append_warning('register_modal_body','danger','glyphicon-remove',response.status.msg);clearTimeout(timeout);clearInterval(interval);$verification_code_btn.removeAttr('disabled');$verification_code_btn.text('获取验证码');}},function(error){console.log(error);modal_append_warning('register_modal_body','danger','glyphicon-remove','出现错误，请重试');clearTimeout(timeout);clearInterval(interval);$verification_code_btn.removeAttr('disabled');$verification_code_btn.text('获取验证码');});});});/**Verify and submit inputs**/$(function(){var $register_modal=$('#register_modal');var $register_btn=$('#register_btn');var $login_modal=$('#login_modal');var status=true;$register_btn.click(function(event){event.preventDefault();if(!USERNAME_REG.test($register_username.val())){$register_username.css('borderColor','red');status=false;}if(!EMAIL_REG.test($register_email.val())){$register_email.css('borderColor','red');status=false;}if(!PASSWORD_REG.test($register_password.val())){$register_password.css('borderColor','red');status=false;}else if($register_password.val()!==$register_password_again.val()){$register_password_again.css('borderColor','red');status=false;}if(!$verification_code.val()){$verification_code.css('borderColor','red');status=false;}if(status===false){modal_append_warning('register_modal_body','danger','glyphicon-remove','填写信息有误');return false;}/**AJAX**/var data={};var _ref3=[$register_username.val(),$register_email.val(),md5($register_password.val()),$verification_code.val()];data.username=_ref3[0];data.email=_ref3[1];data.password=_ref3[2];data.verify=_ref3[3];AJAX('verify',data,function(response){if(response.status.code===0){modal_append_warning('register_modal_body','danger','glyphicon-remove',response.status.msg);}else{modal_append_warning('register_modal_body','success','glyphicon-ok',response.status.msg);setTimeout(function(){$register_modal.modal('hide');$login_modal.modal('show');},3000);}},function(error){console.log(error);modal_append_warning('register_modal_body','danger','glyphicon-remove','出现错误，请重试');});});});/**login**/$(function(){var $login_btn=$('#login_btn');var status=true;$login_btn.click(function(event){event.preventDefault();if(!EMAIL_REG.test($login_email.val())){$login_email.css('borderColor','red');status=false;}if(!PASSWORD_REG.test($login_password.val())){$login_password.css('borderColor','red');status=false;}if(status===false){modal_append_warning('login_modal_body','danger','glyphicon-remove','填写信息有误');return false;}var data={};//data.remember_me = $remember_me_checkbox.is(':checked');
var _ref4=[$login_email.val(),md5($login_password.val()),true];data.email=_ref4[0];data.password=_ref4[1];data.remember_me=_ref4[2];AJAX('login',data,function(response){if(response.status.code===0){modal_append_warning('login_modal_body','danger','glyphicon-remove',response.status.msg);}else{modal_append_warning('login_modal_body','success','glyphicon-ok',response.status.msg);setTimeout(function(){location.href='administration.html';},1000);}},function(error){console.log(error);modal_append_warning('login_modal_body','danger','glyphicon-remove','出现错误，请重试');});});});/**forget password**/$(function(){var $login_modal=$('#login_modal');var _ref5=[$('#forget_modal'),$('#forget_btn'),$('#forget_email'),$('#forget_username')],$forget_modal=_ref5[0],$forget_btn=_ref5[1],$forget_email=_ref5[2],$forget_username=_ref5[3];var _ref6=[$('#new_password_modal'),$('#new_password'),$('#new_password_again'),$('#new_password_modal_btn')],$new_password_modal=_ref6[0],$new_password=_ref6[1],$new_password_again=_ref6[2],$new_password_modal_btn=_ref6[3];var $forget_link=$('#forget_link');$forget_link.click(function(event){event.preventDefault();$login_modal.modal('hide');$forget_modal.modal('show');});var status=false;$forget_btn.click(function(event){event.preventDefault();modal_append_warning('forget_modal_body','info','glyphicon-send',"处理中，请稍后");status=true;if(!USERNAME_REG.test($forget_username.val())){$forget_username.css('borderColor','red');status=false;}if(!EMAIL_REG.test($forget_email.val())){$forget_email.css('borderColor','red');status=false;}if(status===false){modal_append_warning('forget_modal_body','danger','glyphicon-remove','填写信息有误');return false;}var data={};var _ref7=[$forget_username.val(),$forget_email.val()];data.username=_ref7[0];data.email=_ref7[1];AJAX('forget',data,function(response){if(response.status.code===0){modal_append_warning('forget_modal_body','danger','glyphicon-remove',response.status.msg);}else{$forget_modal.modal('hide');$new_password_modal.modal('show');}},function(error){console.log(error);modal_append_warning('forget_modal_body','danger','glyphicon-remove','出现错误，请重试');});});$new_password_modal_btn.click(function(event){event.preventDefault();status=true;if(!PASSWORD_REG.test($new_password.val())){$new_password.css('borderColor','red');status=false;}else if($new_password.val()!==$new_password_again.val()){$new_password_again.css('borderColor','red');status=false;}if(status===false){modal_append_warning('new_password_modal_body','danger','glyphicon-remove','填写信息有误');return false;}var data={};data.new_password=md5($new_password.val());AJAX('new_password',data,function(response){if(response.status.code===0){modal_append_warning('new_password_modal_body','danger','glyphicon-remove',response.status.msg);}else{modal_append_warning('new_password_modal_body','success','glyphicon-ok',response.status.msg);setTimeout(function(){$new_password_modal.modal('hide');},3000);}},function(error){console.log(error);modal_append_warning('new_password_modal_body','danger','glyphicon-remove','出现错误，请重试');});});});