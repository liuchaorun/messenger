'use strict';/**
 * Created by 31641 on 2017-7-6.
 */var picture_pack_info={};//存储每个图片的资源包信息
/**Set height**/$(function(){auto_height('del_picture_panel_body',90);auto_height('del_error_2_modal_body',225);});/**Pull images**//**DOM Structure
 * <div class="del_picture_row">
 <div class="del_picture_div">
 <label id="del_picture_label"><img src="../images/Test.png" alt="test"
 class="del_picture image img-responsive">
 <input type="checkbox" class="checkbox"></label>
 </div>
 </div>
 * **//**
 * data:
 * {
 *      pictures: [
 *                  {id=XXX,src=XXX,pack=[XXX,XXX]},
 *                 ]
 * }
 * **/$(function(){var $error_modal=$('#error_modal');var $del_picture_table=$('#del_picture_table');var PICTURES_PER_ROW=5;AJAX('get_picture_for_del',{},function(response){if(response.status.code===0)$error_modal.modal('show');else{var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=response.data.pictures[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var picture=_step.value;picture_pack_info[picture.id]={};picture_pack_info[picture.id].src=picture.src;picture_pack_info[picture.id].pack=picture.pack;}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}var pictures=response.data.pictures;var row=0;var $row_node=$('<div class="del_picture_row"></div>');for(;row<Math.floor(pictures.length/PICTURES_PER_ROW);row++){for(var i=0;i<PICTURES_PER_ROW;i++){$row_node.append('<div class="del_picture_div"><label id='+pictures[row*PICTURES_PER_ROW+i].id+'  class=\'del_picture_label\'><img src='+pictures[row*PICTURES_PER_ROW+i].src+' alt='+pictures[row*PICTURES_PER_ROW+i].id+' class="image img-responsive del_picture"><input type="checkbox" class="checkbox"></label></div>');}$del_picture_table.append($row_node);$row_node=$('<div class="del_picture_row"></div>');}if(pictures.length-row*PICTURES_PER_ROW>0&&!$('#modify_modal_table_last_row').length){$del_picture_table.append('<div class="del_picture_row" id="del_picture_table_last_row"></div>');for(var _i=0;_i<pictures.length-row*PICTURES_PER_ROW;_i++){$('#del_picture_table_last_row').append('<div class="del_picture_div"><label id='+pictures[row*PICTURES_PER_ROW+_i].id+' class=\'del_picture_label\'><img src='+pictures[row*PICTURES_PER_ROW+_i].src+' alt='+pictures[row*PICTURES_PER_ROW+_i].id+' class="image img-responsive del_picture"><input type="checkbox" class="checkbox"></label></div></div>');}}activate();}},function(error){console.log(error);$error_modal.modal('show');});});/**Load click event**//**
 * <table class="table table-responsive" id="del_picture_with_pack_table">
 <tr>
 <th class="preview">预览</th>
 <th>资源包</th>
 </tr>
 <tr>
 <td><img class="preview" src="../images/Test.png" alt=""></td>
 <td>aaaaa,bbbbb,ccccc</td>
 </tr>
 </table>
 * **/function activate(){var _ref=[$('#del_picture_btn'),$('#del_picture_modal_btn')],$del_picture_btn=_ref[0],$del_picture_modal_btn=_ref[1];var _ref2=[$('#del_error_modal'),$('#del_error_2_modal'),$('#del_picture_modal')],$del_error_modal=_ref2[0],$del_error_2_modal=_ref2[1],$del_picture_modal=_ref2[2];var $del_picture_with_pack_table=$('#del_picture_with_pack_table');var $checkbox=$('.checkbox');/**checkbox effect**/$checkbox.click(function(event){if($(event.target).is(':checked')){$(event.target).parent().parent().css('backgroundImage','url("../images/admin/selected.png")');$(event.target).parent().css('opacity',0.25);}else{$(event.target).parent().removeAttr('style');$(event.target).parent().parent().removeAttr('style');}});$del_picture_btn.click(function(event){event.preventDefault();var checked_checkboxes=$('input:checked');var picture_with_pack=[];if(checked_checkboxes.length===0){$del_error_modal.modal('show');return false;}var data={};data.picture_id=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=checked_checkboxes[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var checkbox=_step2.value;data.picture_id.push(parseInt($(checkbox).parent().attr('id')));if(picture_pack_info[$(checkbox).parent().attr('id')].pack.length!==0)picture_with_pack.push(parseInt($(checkbox).parent().attr('id')));}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}if(picture_with_pack.length===0){$del_picture_modal.modal('show');$del_picture_modal_btn.click(function(){AJAX('del_picture',data,function(response){if(response.status.code===0)modal_prepend_warning('del_picture_modal_footer','danger','glyphicon-remove',response.status.msg,'tip');else{modal_prepend_warning('del_picture_modal_footer','success','glyphicon-ok',response.status.msg,'tip');setTimeout(function(){location.reload(true);},2000);}},function(error){console.log(error);modal_prepend_warning('del_picture_modal_footer','danger','glyphicon-remove','出现错误，请重试','tip');});});}else{$del_picture_with_pack_table.html('<table class="table table-responsive" id="del_picture_with_pack_table"><tbody><tr><th class="preview">\u9884\u89C8</th><th>\u8D44\u6E90\u5305</th></tr></tbody></table>');var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=picture_with_pack[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var id=_step3.value;var packs='';var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=picture_pack_info[id].pack[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var pack=_step4.value;packs+=pack+',';}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}$del_picture_with_pack_table.append('<tr><td><img class="preview" src='+picture_pack_info[id].src+' alt='+id+'></td><td>'+packs.slice(0,packs.length-1)+'</td></tr>');}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}$del_error_2_modal.modal('show');}});}